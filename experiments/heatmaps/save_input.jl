using Pkg
Pkg.activate(@__DIR__)
using DrWatson

using ImageNetDataset
using JLD2

## Manually load 128 images from ImageNet validation set
idxs = [15226, 6148, 41653, 13872, 42198, 8048, 21222, 17714, 37590, 42169, 41977, 2951, 48314, 20855, 7384, 47598, 6470, 37608, 2177, 16762, 48688, 47394, 2778, 9958, 20821, 15291, 49513, 20463, 5512, 15998, 31648, 1222, 20171, 45805, 47751, 2560, 15283, 23277, 21900, 6539, 9985, 36869, 9906, 30021, 25879, 5886, 34602, 29899, 10315, 28115, 46320, 44451, 30887, 46969, 32355, 4899, 39421, 5135, 15240, 4527, 1514, 1668, 3902, 31681, 9125, 30573, 7998, 15393, 25315, 634, 12836, 42427, 887, 11729, 24266, 23671, 23414, 16464, 39572, 8182, 39251, 20380, 2940, 33543, 45743, 31092, 34369, 11145, 8622, 14056, 44407, 10433, 14109, 7758, 1599, 6753, 15830, 38382, 31681, 4002, 8233, 15000, 26607, 41563, 35355, 26161, 4250, 10949, 28400, 29895, 27833, 36104, 7614, 45269, 49236, 48380, 6274, 3812, 15133, 27751, 31028, 425, 12024, 8478, 48211, 6030, 5683, 32716]

## Load data
dataset = ImageNet(:val)
x, y = dataset[idxs]
input = Array(reshape(x, 224, 224, 3, :))
imgs = convert2image(dataset, x)

## Save to JLD2 file
jldsave(datadir("input_batch.jld2"); input = input, labels = y)
jldsave(datadir("image_batch.jld2"); imgs = imgs, labels = y)
display(imgs)
